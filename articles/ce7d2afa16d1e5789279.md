---
title: "PHP(Laravel)ã§SalesForceã®REST APIã‚’åˆ©ç”¨ã™ã‚‹"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Laravel', 'SalesForce']
published: false
---

## æ¦‚è¦
Laravelã§SalesForceã®RESTAPIã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§è¨˜äº‹ã¨ã—ã¦æ®‹ã—ã¦ãŠãã€‚
ã“ã“ã§ã¯ã‚ˆãä½¿ã„ãã†ãªCRUDå‡¦ç†ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’è¨˜è¼‰ã™ã‚‹ã€‚
â€» Laravelç‰¹æœ‰ã®éƒ¨åˆ†ã¯ã‚ã¾ã‚Šãªã„ã®ã§ã€ä»–ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ç”ŸPHPã§ã‚‚ã„ã‘ã¾ã™ã€‚

## å‰æ
- SalesForceã®APIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯v47.0ã¨ã™ã‚‹
- Laravel(5.8)ã®Controllerã¨Guzzle(6.5)ã‚’åˆ©ç”¨ã™ã‚‹
- access_tokenã€refresh_tokenã¯å–å¾—æ¸ˆã¨ã™ã‚‹
    + [access_tokenã®å–å¾—æ–¹æ³•ã¯ã“ã¡ã‚‰](https://zenn.dev/articles/04cbe4d02138b6bb0265/preview)
    + [refresh_tokenã®å–å¾—æ–¹æ³•ã¯ã“ã¡ã‚‰](https://zenn.dev/nagi125/articles/29bfe0386fb0bd9e655e)
- æ¨™æº–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å–å¼•å…ˆ(Account)ã‚’åˆ©ç”¨ã™ã‚‹

## CRUDå‡¦ç†ã‚µãƒ³ãƒ—ãƒ«
### CREATE
```php
    /**
     * SalesForce REST API Create
     * @Route /sample/sf/api/create
     * @Method POST
     */
    public function sfApiCreateRecord()
    {
        // ç’°å¢ƒã«ã‚ˆã£ã¦é•ã†ã®ã§è‡ªåˆ†ã®ç’°å¢ƒã®å€¤ã«å¤‰æ›´ã—ã¦ãã ã•ã„
        $sfUrl = 'https://hoge.salesforce.com';
        $path  = '/services/data/v47.0/sobjects/account';

        $url   = $sfUrl . $path;
        $token = 'hogefugapiyo'; //tokenã‚’è‡ªå‹•ã§å–å¾—ã—ã¦ãã‚‹ã‚ˆã†ãªä»•çµ„ã¿ã¯ã“ã®è¨˜äº‹ã§ã¯çœç•¥ã™ã‚‹

        $postData = [
            'Name' => 'nagi125',
            'Description' => 'REST API test',
        ];

        $params = [
            'headers' => [
                'Content-Type' => 'application/json',
                'Authorization' => 'Bearer '.$token,
            ],
            'body' => json_encode($postData),
        ];

        $client = new \GuzzleHttp\Client();
        $res = $client->request('POST', $url, $params);

        // çµæœã®ç¢ºèª
        dd($res->getBody()->getContents());
    }
```


### READ
```php
    /**
     * SalesForce REST API Read
     * @Route /sample/sf/api/read
     * @Method GET
     */
    public function sfApiReadRecord()
    {
        $sfUrl = 'https://hoge.salesforce.com';
        $path  = '/services/data/v47.0/sobjects/account/';
        $sfId  = 'hogefuga';

        // ã“ã®ã‚ˆã†ã«SQLã®çµæœã‚‚å–å¾—ã§ãã‚‹
        // $path = '/services/data/v47.0/query/?q=SELECT+Id,Name+From+Account';

        $url   = $sfUrl . $path . $sfId;
        $token = 'hogefugapiyo';

        $params = [
            'headers' => [
                'Authorization' => 'Bearer '.$token,
            ],
        ];

        $client = new \GuzzleHttp\Client();
        $res = $client->request('GET', $url, $params);

        // çµæœã®ç¢ºèª
        dd($res->getBody()->getContents());
    }
```

### UPDATE
```php
    /**
     * SalesForce REST API Update
     * @Route /sample/sf/api/update
     * @Method PATCH
     */
    public function sfApiUpdateRecord()
    {
        $sfUrl = 'https://hoge.salesforce.com';
        $path  = '/services/data/v47.0/sobjects/account/';
        $sfId  = 'hogefuga';

        $url   = $sfUrl . $path . $sfId;
        $token = 'hogefugapiyo';

        $postData = [
            'Name' => 'nagi125_update',
        ];

        $params = [
            'headers' => [
                'Content-Type' => 'application/json',
                'Authorization' => 'Bearer '.$token,
            ],
            'body' => json_encode($postData),
        ];

        $client = new \GuzzleHttp\Client();
        $res = $client->request('PATCH', $url, $params);

        // çµæœã®ç¢ºèª
        dd($res->getBody()->getContents());
    }
```

### DELETE
```php
    /**
     * SalesForce RestAPI Delete
     * @Route /sample/sf/api/delete
     * @Method DELETE
     */
    public function sfApiDeleteRecord()
    {
        $sfUrl = 'https://hoge.salesforce.com';
        $path  = '/services/data/v47.0/sobjects/account/';
        $sfId  = 'hogefuga';

        $url   = $sfUrl . $path . $sfId;
        $token = 'hogefugapiyo';

        $params = [
            'headers' => [
                'Authorization' => 'Bearer '.$token,
            ],
        ];

        $client = new \GuzzleHttp\Client();
        $res = $client->request('DELETE', $url, $params);

        // çµæœã®ç¢ºèª(deleteã®å ´åˆã€æˆåŠŸæ™‚ã«æ–‡å­—åˆ—ãŒè¿”ã£ã¦ã“ãªã„ã®ã§StatusCodeã§ç¢ºèª)
        dd($res->getStatusCode());
    }
```

## ãã®ä»–
æ®‹ã‚Šã®æ“ä½œã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã¯[REST APIã®ä»•æ§˜æ›¸](https://developer.salesforce.com/docs/atlas.ja-jp.api_rest.meta/api_rest/intro_what_is_rest_api.htm)ã‚’è¦‹ã‚‹ã¨ã‚ˆã„ã§ã™ã€‚
