---
title: "Docker + Nginx + Laravel(PHP-FPM)ãªç’°å¢ƒã®è¡¨ç¤ºãƒ­ã‚°ã‚’æ•´ç†ã™ã‚‹"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Laravel', 'Docker', 'Nginx']
published: true
---

## æ¦‚è¦
docker-composeã§Nginx + Laravel(PHP-FPM)ã®ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã¦ã€ãƒ­ã‚°ãŒã”ã¡ã‚ƒã£ã¨ã—ã¦ã„ãŸãŸã‚å¿…è¦ãªç‰©ã ã‘è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/qonf386r07geefphice6iwmga1m5)

## æ§‹æˆå›³
![](https://storage.googleapis.com/zenn-user-upload/9ykuxzcn2jabm4dwjr2e05rl6z3c)

## æ¶ˆã—æ–¹
PHP-FPMã®DockerImageã«ã¯
/usr/local/etc/php-fpm.d
ã«ã€Œdocker.confã€ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¦ãŠã‚Šã€ã“ã“ã§ãƒ­ã‚°ã®åˆ¶å¾¡ãŒã§ãã‚‹ã€‚

/usr/local/etc/php-fpm.d/docker.conf
```
[global]
error_log = /proc/self/fd/2

[www]
; if we send this to /proc/self/fd/1, it never appears
access.log = /proc/self/fd/1 â† ã“ã‚Œã‚’2ã‹ã‚‰1ã«ã™ã‚‹

clear_env = no

; Ensure worker stdout and stderr are sent to the main error log.
catch_workers_output = yes
```
buildæ™‚ã«COPYã§ã‚³ãƒ³ãƒ†ãƒŠã«é€ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚

## Laravelã®ãƒ­ã‚°ã‚’stderrã«åãå‡ºã™
config/logging.phpã«ãƒ­ã‚°è¨­å®šãŒã‚ã‚‹ã®ã§ã¾ãšãã“ã§LogLevelã®å¤‰æ›´ã‚’ã—ã¾ã™ã€‚

config/logging.php
```php
    'stderr' => [
        'driver' => 'monolog',
        'handler' => StreamHandler::class,
        'formatter' => env('LOG_STDERR_FORMATTER'),
        'with' => [
            'stream' => 'php://stderr',
        ],
        'level' => 'debug', // ã“ã“ã‚’æ›¸ãè¶³ã™
    ],
```
æ¬¡ã«Dockerfileã‹docker-compose.yamlã«ç’°å¢ƒå¤‰æ•°(LOG_CHANNEL)ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚

docker-compose.yml
```yml
  app:
    container_name: app
    build: ./
    environment:
      APP_ENV: 'development'
      APP_DEBUG: 'true'
      LOG_CHANNEL: 'stderr'
```

## çµæœ
PHP-FPMå´ã¯Laravelã®logã ã‘ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/9rbl1yavuzu6ho9p2bgbpybx4uaz)
