---
title: "Dockerã§Terraformã‚’ä½¿ã†"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker", "terraform"]
published: true
---

## æ¦‚è¦
ä»•äº‹ã§Terraformã‚’ä½¿ã„å§‹ã‚ãŸã®ã§ã€å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠãã€‚

## Dockerç’°å¢ƒã®æº–å‚™
å…¬å¼ã®DockerImageãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã€‚
https://hub.docker.com/r/hashicorp/terraform/

ä¸‹è¨˜ã®4ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°å®Ÿè¡Œã§ãã¾ã™ã€‚
â€» moduleã®ä½¿ã„æ–¹ç­‰ã¯ã“ã“ã§ã¯è§¦ã‚Œã¾ã›ã‚“

docker-compose.yml
```yml
version: '3'
services:
  terraform:
    container_name: terraform
    image: hashicorp/terraform:0.14.7
    env_file:
      - .env
    volumes:
      - .:/terraform
    working_dir: /terraform
    entrypoint: ash
    tty: true
```

.gitignore
```
# IDE
.idea

# env
.env

# Terraform
.terraform
*.tfstate
*.tfstate.backup
```

.env.example
```
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

TF_VAR_HOGE=
```
å…¬å¼ã®DockerImageã¯AWS_KEYã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã™ã‚Œã°å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

main.tf
```hcl
# Sample

provider "aws" {
  region = "ap-northeast-1"
}

variable "vpc_cidr" {
  default = "10.0.0.0/16"
}

resource "aws_vpc" "main" {
  cidr_block = var.vpc_cidr

  tags = {
    Name = var.app_name
  }
}

```

## ä½¿ã„æ–¹
1. .envã‚’ä½œæˆã—ã¦AWSã®KEYã‚’å…¥åŠ›
    ```
    $ cp .env.example .env
    $ vim .env
    ```
2. docker-compose upã§èµ·å‹•ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
    ```
    $ docker-compose up -d
    $ docker-compose exec terraform /bin/ash
    ```
3. initã—ã¦plan...etc
    ```
    # terraform init
    # terraform plan
    ```

## æ³¨æ„äº‹é …
.envã‚’gitç®¡ç†ã™ã‚‹ã¨AWS_KEYãŒæ¼ã‚Œã¦ãƒã‚¤ãƒ‹ãƒ³ã‚°ã¨ã‹ã•ã‚Œã‚‹ã®ã§å¿…ãš.gitignoreã«å…¥ã‚Œã‚‹äº‹ï¼
