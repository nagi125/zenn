---
title: "Nuxt.js + Laravelã«ã‚ˆã‚‹SPAé–‹ç™º(ãƒªãƒã‚¸ãƒˆãƒªåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³)"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nuxtjs, laravel, docker]
published: true
---

## æ¦‚è¦
ä»•äº‹ã§Nuxtã¨Laravelã§SPAã‚’æ§‹ç¯‰ã™ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸãŸã‚ç’°å¢ƒæ§‹ç¯‰æ–¹æ³•ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠãã€‚

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- Nuxt: 2.14.x
- PHP: 8.0.x
- Laravel: 8.x
- PostgreSQL: 12.x

## å‰æ
Laravelã®å…¬å¼ã§ã¯èªè¨¼ã§Sanctumã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’å‹§ã‚ã¦ã„ã¾ã™ãŒã€
Multièªè¨¼æ–¹æ³•ãŒèª¿ã¹ã¦ã‚‚ã§ã¦ã“ãªã‹ã£ãŸãŸã‚Sessionèªè¨¼ã‚’ä½¿ã£ã¦å®Ÿè£…ã™ã‚‹ã€‚
[Sanctumã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„](https://zenn.dev/nagi125/articles/78d931f9b72fff1f1a7d)

ã¾ãŸã€å„ç¨®Dockerfileã®èª¬æ˜ã¯è¨˜äº‹ã®é•·ã•ã®é–¢ä¿‚ä¸Šçœç•¥ã—ã¦ã‚ã‚Šã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚
https://github.com/nagi125/sample-spa-nuxt/tree/main/.docker
https://github.com/nagi125/sample-spa-laravel/tree/main/.docker

## æ§‹æˆå›³
![](https://storage.googleapis.com/zenn-user-upload/28e7un4lkhutnucyc68bdqtpvw2v)

## Nuxtå´è¨­å®š
### å®Œæˆå“
https://github.com/nagi125/sample-spa-nuxt

### docker-compose
æ§‹æˆå›³ã®å·¦ã®ã‚ˆã†ã«Nuxtã‚³ãƒ³ãƒ†ãƒŠã ã‘ã®æ§‹æˆã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚
Backendã¨ã®é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã«Networkã‚’Backendã§å®šç¾©ã—ã¦ã„ã‚‹sample-spaã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```yml
# docker-compose.yml
version: '3'
services:
  web:
    container_name: sample-spa-nuxt
    build:
      context: ./.docker/web
      dockerfile: Dockerfile
    environment:
      PORT: '3000'
      HOST: '0.0.0.0'
      # axiosã§åˆ©ç”¨ã™ã‚‹ãŸã‚APIã®Originã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æŒãŸã›ã¦ãŠã
      BASE_URL: 'http://nginx'
    ports:
      - 3000:3000
    volumes:
      - .:/app
    stdin_open: true
    tty: true
    restart: always
    networks:
      - sample-spa

networks:
  sample-spa:
    external: true
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

#### ç’°å¢ƒã®ç«‹ã¡ä¸Šã’
```
$ docker-compose up
```

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã¨currentã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã§ããªã„ãŸã‚ã€Œblogã€ã¨ã™ã‚‹ã€‚
```
$ docker-compose exec web yarn create nuxt-app blog
```

ä¸‹è¨˜ã®ã‚ˆã†ã«èª˜å°ã•ã‚Œã‚‹ã®ã§å¿…è¦ãªé …ç›®ã‚’å…¥åŠ›ã™ã‚‹(ã‚µãƒ³ãƒ—ãƒ«ã§è¼‰ã›ã¦ãŠãã¾ã™ã€‚)
```
? Project name: blog
? Programming language: JavaScript
? Package manager: Yarn
? UI framework: Bootstrap Vue
? Nuxt.js modules: (Press <space> to select, <a> to toggle all, <i> to invert selection)
? Linting tools: (Press <space> to select, <a> to toggle all, <i> to invert selection)
? Testing framework: None
? Rendering mode: Single Page App
? Deployment target: Server (Node.js hosting)
? Development tools: (Press <space> to select, <a> to toggle all, <i> to invert selection)
? What is your GitHub username? nagi125
? Version control system: None

ğŸ‰  Successfully created project blog
```

ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’currentã«ç§»å‹•ã•ã›ã‚‹
```
$ cp -R blog/. ./
$ rm -r blog
```

### å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ 
èªè¨¼ãƒ»APIã¨ã®é€šä¿¡ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ 
```
$ docker-compose exec web yarn add @nuxtjs/auth @nuxtjs/axios @nuxtjs/proxy
```

SASSã§é–‹ç™ºã§ãã‚‹ã‚ˆã†ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ 
```
$ docker-compose exec web yarn add --dev sass sass-loader fibers
```

### ã‚³ãƒ³ãƒ•ã‚£ã‚°è¨­å®š
- cssã¯BootstrapVueã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ãã®èª­ã¿è¾¼ã¿ã¨ã€ã‚«ã‚¹ã‚¿ãƒ cssç”¨ã«app.scssã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚
- moduleã¯è¿½åŠ ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ä½œæˆæ™‚ã«æŒ‡å®šã—ãŸbootstrap-vueã‚’æŒ‡å®šã—ã¾ã™ã€‚
- authè¨­å®šã«ã¤ã„ã¦APIå´ã®å®Ÿè£…æ–¹æ³•ã«ã‚ˆã£ã¦ã€URLãŒå¤‰ã‚ã‚Šã¾ã™ã®ã§ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
  +  [ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã§ç¢ºèªã™ã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“](https://auth.nuxtjs.org/api/options)

```js
export default {
  css: [
    '~/node_modules/bootstrap-vue/dist/bootstrap-vue.css',
    { src: '~/assets/scss/app.scss', lang: 'scss'}
  ],
  modules: [
    '@nuxtjs/auth',
    '@nuxtjs/axios',
    '@nuxtjs/proxy',
    'bootstrap-vue/nuxt',
  ],
  axios: {
    proxy: true,
  },
  proxy: {
    '/api/': {
      target: process.env.BASE_URL,
    }
  },
  auth: {
    redirect: {
      login: '/login',
      logout: '/login',
      callback: false,
      home: '/'
    },
    strategies: {
      local: {
        endpoints: {
          login: { url: '/api/admin/auth/login', method: 'post', propertyName: false },
          user: { url: '/api/admin/user', method: 'get', propertyName: false },
          logout: false
        },
        tokenRequired: false,
        tokenType: false,
      }
    },
    localStorage: false,
  },

  router: {
    middleware: ['auth']
  },
}
```

### ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
ã“ã¡ã‚‰ã‚’è¨˜äº‹ã¨ã—ã¦æ›¸ãã¨ã€ã¨ã¦ã‚‚é•·ããªã£ã¦ã—ã¾ã†ãŸã‚ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ç¢ºèªã‚’ãŠã­ãŒã„ã—ã¾ã™ã€‚
#### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
https://github.com/nagi125/sample-spa-nuxt/blob/main/pages/login.vue

#### èªè¨¼å¾Œã®ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸
https://github.com/nagi125/sample-spa-nuxt/blob/main/pages/index.vue

## Laravelå´è¨­å®š
### å®Œæˆå“
https://github.com/nagi125/sample-spa-laravel

### docker-compose
æ§‹æˆå›³ã®å³å´ã®ã‚ˆã†ã«Nginx + PHP-FPMã®æ§‹æˆã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚
ã¾ãŸNuxtã‹ã‚‰ç›´æ¥é€šä¿¡ã™ã‚‹ãŸã‚ã«dockerã®Networkã‚’å…±é€šã®ã€Œsample-spaã€ã¨ã—ã¦ã„ã¾ã™ã€‚

```yml
# docker-compose.yml
version: '3'
services:
  nginx:
    container_name: sample-spa-nginx
    build:
      context: .docker/nginx
      dockerfile: Dockerfile
    ports:
      - 80:80
    volumes:
      - .:/app
    tty: true
    depends_on:
      - api

  api:
    container_name: sample-spa-api
    build:
      context: .docker/api
      dockerfile: Dockerfile
    environment:
      LANG: 'ja_JP.UTF-8'
      TZ: 'Asia/Tokyo'
      APP_NAME: 'Laravel'
      APP_ENV: 'development'
      APP_DEBUG: 'true'
      APP_URL: 'http://localhost'
      LOG_CHANNEL: 'stderr'
      DB_CONNECTION: 'pgsql'
      DB_HOST: 'db'
      DB_PORT: '5432'
      DB_DATABASE: 'laravel_development'
      DB_DATABASE_TEST: 'laravel_testing'
      DB_USERNAME: 'docker'
      DB_PASSWORD: 'docker'
    env_file:
      - .env
    volumes:
      - .:/app
    expose:
      - 9000
    tty: true
    depends_on:
      - db

  db:
    image: postgres:12-alpine
    container_name: sample-spa-db
    environment:
      TZ: 'Asia/Tokyo'
      POSTGRES_USER: 'docker'
      POSTGRES_PASSWORD: 'docker'
      POSTGRES_DB: 'laravel_development'
    volumes:
      - ./.docker/db/data:/var/lib/postgresql/data
      - ./.docker/db/sql:/docker-entrypoint-initdb.d
    ports:
      - 5432:5432

networks:
  default:
    name: sample-spa
```

### Networkã®ä½œæˆ
ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹å‰ã«Networkã‚’ä½œã‚Œã¨æ€’ã‚Œã‚‹ã¯ãšãªã®ã§æŒ‡å®šã—ãŸåå‰ã®Networkã‚’ä½œã‚Šã¾ã™ã€‚
```
$ docker network create sample-spa
```

### ç’°å¢ƒã®ç«‹ã¡ä¸Šã’
```
$ docker-compose up
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã¨currentã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã§ããªã„ãŸã‚ã€Œblogã€ã¨ã™ã‚‹ã€‚
```
$ docker-compose exec api composer create-project "laravel/laravel=8.*" blog
```

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€å¼currentã«ç§»å‹•ã•ã›ã‚‹
```
$ cp -R blog/. ./
$ rm -r blog
```

### Authé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
èªè¨¼ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã™ã‚‹ã€‚
```
docker-compose exec api composer require laravel/ui
```

### CORSã®è¨­å®š
Laravel8ã§ã¯corsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã€‚
dockerå†…ã®é€šä¿¡ã§ã‚ã‚‹ãŸã‚nuxtå´ã®ã‚³ãƒ³ãƒ†ãƒŠåã§ã‚ã‚‹ã€Œwebã€ã‚’æŒ‡å®šã™ã‚‹ã€‚
```php
// config/cors.php
'allowed_origins' => [
    'http://web',
],
```

### Authã®è¨­å®š
Tokenèªè¨¼ã§ã¯ãªãã€Sessionèªè¨¼ã«ã™ã‚‹ãŸã‚driverã‚’sessionã«å¤‰æ›´ã™ã‚‹ã€‚
```php
// config/auth.php
'api' => [
    'driver' => 'session',
    'provider' => 'users',
],
```

### Middlewareã®è¨­å®š
Sessionèªè¨¼ã¨CORSã§å¿…è¦ãªClassã‚’è¿½åŠ ã™ã‚‹ã€‚
```php
// app/Http/Kernel.php
'api' => [
  \Fruitcake\Cors\HandleCors::class,
  \App\Http\Middleware\EncryptCookies::class,
  \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
  \Illuminate\Session\Middleware\StartSession::class,
  \Illuminate\View\Middleware\ShareErrorsFromSession::class,
],
```

### Seederã®æº–å‚™
ãƒ­ã‚°ã‚¤ãƒ³ã¨å‹•ä½œç¢ºèªç”¨ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®seedã‚’ä½œæˆã—ã¾ã™ã€‚
https://github.com/nagi125/sample-spa-laravel/commit/06231c0193db694f21cd499afc1acdc85c106529
https://github.com/nagi125/sample-spa-laravel/commit/41c2207060ba9c54b306fdcd4a14430f9ca5fba4

ã‚³ãƒ¼ãƒ‰ã®æº–å‚™ãŒã§ããŸã‚‰ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§seedã‚’æµã—è¾¼ã¿ã¾ã™ã€‚
```
docker-compose exec api php artisan migrate:refresh --seed
```

### LoginControllerã¨UserControllerã®æº–å‚™
ç›®çš„ã¯é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ãªã®ã§ã€ã“ã“ã«é–¢ã—ã¦ã®è§£èª¬ã¯çœç•¥ã—ã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚’å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

#### Route
https://github.com/nagi125/sample-spa-laravel/blob/main/routes/api.php

#### LoginController
https://github.com/nagi125/sample-spa-laravel/blob/main/app/Http/Controllers/Api/Admin/Auth/LoginController.php

#### UserController
https://github.com/nagi125/sample-spa-laravel/blob/main/app/Http/Controllers/Api/Admin/UserController.php

## å‹•ä½œç¢ºèª
### ç’°å¢ƒç«‹ã¡ä¸Šã’
Nuxtã¨Laravelã©ã¡ã‚‰ã‚‚ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹
```
$ docker-compose up
```

### Nuxtå´ç’°å¢ƒç«‹ã¡ä¸Šã’
```
$ docker-compose exec web yarn dev
```

### ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®å‹•ä½œç¢ºèª
ä¸‹è¨˜ã®URLã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚
http://localhost:3000/login
![](https://storage.googleapis.com/zenn-user-upload/fxfbqqm0cal95eb0ir5fq9zcdanv)

### ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®å‹•ä½œç¢ºèª
ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†å¾Œä¸‹è¨˜ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/lvmbrjv8a0dt750o9s7ifg6mxphd)

Userè¡¨ç¤ºã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨APIã«å•ã„åˆã‚ã›ã«è¡Œãã€ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
â€» ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/393faenrxpxxhbb8t12ah5l2a3yg)

## æœ€å¾Œã«
å‚™å¿˜éŒ²ãªã®ã§è©³ç´°ã¯GitHubè¦‹ã‚ã¿ãŸã„ãªæ„Ÿã˜ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã¾ã™ãŒã€
Nuxt + Laravelã®é–‹ç™ºç’°å¢ƒã¯ä»¥ä¸Šã§ä½œã‚Œã¾ã™ã®ã§SPAã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ãŸã„ã¨ã„ã†æ–¹ã«å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
