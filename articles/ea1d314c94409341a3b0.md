---
title: "Docker + Nginx + Laravelã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã‹ã‚‰Herokuã¸ã®Deployã¾ã§"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['docker', 'nginx', 'laravel', 'heroku'] 
published: false
---

## æ¦‚è¦
æ™‚ä»£ã¯SPAã§ã™ãŒã€ã¾ã ã¾ã ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ãªç’°å¢ƒã‚’ä½œã‚‹å ´é¢ãŒã‚ã‚‹ã®ã§ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚
Laravelã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚
â€»1. è¨˜äº‹ã§ã¯LTSã§ã‚ã‚‹6ç³»ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
â€»2. DBã¯Herokuã¸Deployã™ã‚‹äº‹ã‚’å‰æã¨ã—ã¦ã„ã‚‹ã®ã§PostgreSQLã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

## DockerImageã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç­‰
- php:7.4-fpm-alpine
- nginx:1.19-alpine
- postgres:12

## å®Œæˆå›³ã¨æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰
### å®Œæˆå›³
![](https://storage.googleapis.com/zenn-user-upload/9hlmb25kl5fo477q9yynz8931arr)

### æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰
https://github.com/nagi125/laravel-docker-template
Herokuã«ç›´æ¥Deployã§ãã‚‹ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’èª¿æ•´ã—ã¦ã‚ã‚Šã¾ã™ã€‚ 

### ã–ã£ãã‚Šè§£èª¬
.dockerãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«Dockerfileã¨confãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¦ã€docker-compose.ymlã«ã¦ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒ†ãƒŠã®é–¢ä¿‚ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
Nginxã®ã€Œ/app/publicã€ã¨Laravelã®ã€Œ/app/publicã€ãŒå…±æœ‰ã—ã¦ã„ã‚‹ã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚
ã“ã“ã®å…±æœ‰ãŒã§ãã¦ã„ãªã„ã¨ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã™äº‹ãŒã§ãã¾ã›ã‚“ã€‚

docker-compose.yml
```yml
version: '3'
services:
  nginx:
    container_name: nginx
    build: .docker/nginx
    ports:
      - 80:80
    volumes:
      - .:/app
    tty: true
    restart: always
    depends_on:
      - app

  app:
    container_name: app
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      LANG: 'ja_JP.UTF-8'
      TZ: 'Asia/Tokyo'
      LOG_CHANNEL: 'stderr'
      DB_CONNECTION: 'pgsql'
      DB_HOST: 'db'
      DB_PORT: '5432'
      DB_DATABASE: 'laravel_development'
      DB_USERNAME: 'docker'
      DB_PASSWORD: 'docker'
    volumes:
      - .:/app
    expose:
      - 9000
    tty: true
    restart: always
    depends_on:
      - db

  db:
    image: postgres:12
    container_name: db
    environment:
      TZ: 'Asia/Tokyo'
      POSTGRES_USER: 'docker'
      POSTGRES_PASSWORD: 'docker'
      POSTGRES_DB: 'laravel_development'
    volumes:
      - db:/var/lib/postgresql/data
    ports:
      - 5432:5432

volumes:
  db:
```

## Laravelã®æº–å‚™
https://github.com/nagi125/laravel-docker-template
ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦Laravelã®æº–å‚™ã‚’ã—ã¾ã™ã€‚

### ç’°å¢ƒç«‹ã¡ä¸Šã’
```
$ docker-compose up
```

### Laravelã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ç›´ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œã‚ã†ã¨ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ã¦æ€’ã‚‰ã‚Œã‚‹ãŸã‚ã€ä¸€åº¦ã€Œblogã€ã¨ã—ã¦ä½œæˆã—ã¾ã™ã€‚
```
$ docker-compose exec app composer create-project --prefer-dist laravel/laravel blog "6.*"
```

blogå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´ä¸‹ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
â€»Macå´ã§ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚’ã™ã‚‹ã¨æ—©ãçµ‚ã‚ã‚Šã¾ã™ã€‚
```
$ docker-compose exec app cp -R ./blog/. ./
```

æœ€å¾Œã«blogã‚’å‰Šé™¤ã—ã¾ã™ã€‚
```
$ docker-compose exec app rm -rf blog
```

ã€Œhttp://localhostã€ã§Welcomeç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚
